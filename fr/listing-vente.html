<!DOCTYPE html>
<html prefix="og: http://ogp.me/ns#" lang="fr">
<head>
    <meta charset="UTF-8">
    <title>ACCES IMMOBILIER - Liste des biens en vente</title>
    <meta name="viewport" content="width=device-width, initial-scale=1">
    
    <link rel="stylesheet" href="../modele/css/bootstrap.minb1fb.css">
    <link rel="stylesheet" href="../css/premium/mainb001.css">
    <link rel="stylesheet" href="../modele/css/main2f8b.css">
    <link rel="stylesheet" href="../assets/css/appcffb.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.2.1/css/all.min.css">
    
    <style>
        /* Un peu de style pour rendre ça joli tout de suite */
        .card-annonce { border: none; box-shadow: 0 2px 15px rgba(0,0,0,0.1); margin-bottom: 30px; transition: transform 0.3s; }
        .card-annonce:hover { transform: translateY(-5px); }
        .photo-container { height: 250px; overflow: hidden; position: relative; }
        .photo-container img { width: 100%; height: 100%; object-fit: cover; }
        .card-body { padding: 20px; text-align: left; }
        .prix-annonce { color: #c49a6c; font-weight: bold; font-size: 1.4rem; }
        .titre-annonce { font-size: 1.1rem; font-weight: 600; margin: 10px 0; color: #333; height: 50px; overflow: hidden; }
        .details-annonce { color: #666; font-size: 0.9rem; margin-bottom: 15px; }
        .btn-detail { background-color: #c49a6c; color: white; border: none; padding: 10px 20px; width: 100%; }
        .btn-detail:hover { background-color: #a37d55; color: white; text-decoration: none; }
    </style>
</head>

<body class="listing-vente">

    <div class="header text-sm-center">
        <div class="sticky_menu">
            <div class="site-container">
                <a href="../fr.html" class="header__logo">
                    <img src="../assets/images/logo4561.jpg" class="img-fluid" alt="ACCES IMMOBILIER" style="max-height:80px; margin:10px;">
                </a>
                <div class="container">
                    <nav class="menu">
                        <ul>
                            <li><a href="../fr.html">Accueil</a></li>
                            <li class="active"><a href="listing-vente.html">Vente</a></li>
                            <li><a href="listing-location.html">Location</a></li>
                            <li><a href="contact.html">Contact</a></li>
                        </ul>
                    </nav>
                </div>
            </div>
        </div>
    </div>

    <div class="container mt-5 mb-3">
        <div class="row">
            <div class="col-12 text-center">
                <h1 class="display-4 home_heading2">Nos biens <span>à la vente</span></h1>
                <div class="bg-gris mt-2 mb-4"></div>
            </div>
        </div>
    </div>

    <div class="container" id="conteneur-biens">
        <div class="text-center" id="message-chargement">
            <i class="fas fa-circle-notch fa-spin fa-3x" style="color:#c49a6c;"></i>
            <p class="mt-3">Chargement des offres en cours...</p>
        </div>
        <div class="row" id="liste-resultats">
            </div>
    </div>

    <footer class="mt-5">
        <div class="container">
            <div class="row align-items-center">
                <div class="col-12 text-center">
                    <p>ACCES IMMOBILIER - 27 avenue Pasteur 11800 Trèbes - 04 68 78 53 20</p>
                </div>
            </div>
        </div>
    </footer>

    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <script>
    $(document).ready(function() {
        const apiUrl = "https://apim.skysignage.com/WCF/connector/d12a2a90-f1f7-59b0-a8ca-247e2907debf/78ecd32d-d37c-5628-8ab1-70a2792afb18?subscription-key=3a826b2799bd491aae7814f41351a46a";

        // Fonction pour extraire une valeur de l'API
        function getVal(tableau, nomChamp) {
            let item = tableau.find(x => x.std_name === nomChamp);
            return item ? item.value : "";
        }

        $.getJSON(apiUrl, function(reponse) {
            $('#message-chargement').hide(); // On cache le chargement

            if (reponse.success && reponse.data) {
                let compteur = 0;
                
                $.each(reponse.data, function(index, annonceData) {
                    
                    // ON FILTRE : On ne garde que les VENTES (category "0")
                    let categorie = getVal(annonceData, "category");
                    if (categorie !== "0") return; // Si ce n'est pas une vente, on passe au suivant

                    compteur++;
                    
                    // Récupération des données
                    let id = getVal(annonceData, "id");
                    let titre = getVal(annonceData, "title");
                    let ville = getVal(annonceData, "city");
                    let prix = getVal(annonceData, "price_format");
                    let surface = getVal(annonceData, "area_size_format");
                    let pieces = getVal(annonceData, "rooms") || getVal("bedrooms"); // Parfois rooms, parfois bedrooms
                    let photos = getVal(annonceData, "pictures");
                    let photoUrl = (photos && photos.length > 0) ? photos[0] : '../assets/images/sans-photo.jpg';

                    // Création du code HTML pour une carte
                    let htmlAnnonce = `
                        <div class="col-md-4 col-sm-6">
                            <div class="card card-annonce">
                                <div class="photo-container">
                                    <a href="detail.html?id=${id}">
                                        <img src="${photoUrl}" alt="${titre}">
                                    </a>
                                    <div style="position:absolute; top:10px; right:10px; background:rgba(255,255,255,0.9); padding:5px 10px; border-radius:20px; font-weight:bold; color:#c49a6c;">
                                        VENTE
                                    </div>
                                </div>
                                <div class="card-body">
                                    <h3 class="titre-annonce">${titre}</h3>
                                    <div class="prix-annonce">${prix}</div>
                                    <p class="details-annonce">
                                        <i class="fas fa-map-marker-alt"></i> ${ville} &nbsp;|&nbsp; 
                                        <i class="fas fa-expand"></i> ${surface} &nbsp;|&nbsp; 
                                        <i class="fas fa-bed"></i> ${pieces} ch.
                                    </p>
                                    <a href="detail.html?id=${id}" class="btn btn-detail">Voir le détail</a>
                                </div>
                            </div>
                        </div>
                    `;

                    $('#liste-resultats').append(htmlAnnonce);
                });

                if (compteur === 0) {
                    $('#liste-resultats').html('<div class="col-12 text-center">Aucun bien à la vente pour le moment.</div>');
                }
            }
        }).fail(function() {
            $('#message-chargement').html('<p style="color:red">Erreur de chargement. Vérifiez votre connexion.</p>');
        });
    });
    </script>

</body>
</html>
