<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <title>DIAGNOSTIC API</title>
    <style>body{font-family:monospace; padding:20px; background:#f0f0f0;} .box{background:white; padding:20px; border:1px solid #ccc; margin-bottom:20px;}</style>
</head>
<body>

    <div class="box">
        <h2>ÉTAPE 1 : Test de connexion</h2>
        <div id="resultat">En attente...</div>
    </div>

    <div class="box">
        <h2>ÉTAPE 2 : Détails techniques</h2>
        <div id="details" style="color:blue;"></div>
        <div id="erreur" style="color:red; font-weight:bold;"></div>
    </div>

    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <script>
        $(document).ready(function() {
            // Ton URL API
            const targetUrl = "https://apim.skysignage.com/WCF/connector/d12a2a90-f1f7-59b0-a8ca-247e2907debf/78ecd32d-d37c-5628-8ab1-70a2792afb18?subscription-key=3a826b2799bd491aae7814f41351a46a";
            
            // Le Proxy
            const proxyUrl = "https://api.allorigins.win/raw?url=" + encodeURIComponent(targetUrl);

            $("#details").html("Tentative de connexion vers : <br>" + proxyUrl);

            $.getJSON(proxyUrl, function(data) {
                // SUCCÈS
                $("#resultat").html("<h3 style='color:green'>✅ SUCCÈS ! Connexion réussie.</h3>");
                
                // On regarde ce qu'on a reçu
                if (Array.isArray(data)) {
                    $("#details").append("<br><br>J'ai reçu une liste de " + data.length + " éléments directement.");
                    $("#details").append("<br>Exemple du 1er titre : " + (data[0].find(x => x.std_name === "title").value));
                } else if (data.data) {
                    $("#details").append("<br><br>J'ai reçu un objet contenant .data (" + data.data.length + " éléments).");
                } else {
                    $("#details").append("<br><br>J'ai reçu des données mais le format est bizarre.");
                    console.log(data);
                }

            }).fail(function(jqXHR, textStatus, errorThrown) {
                // ÉCHEC
                $("#resultat").html("<h3 style='color:red'>❌ ÉCHEC. Impossible de lire les données.</h3>");
                $("#erreur").html("Code erreur : " + jqXHR.status + " (" + textStatus + ")<br>Raison : " + errorThrown);
                
                if (jqXHR.status == 0) {
                    $("#erreur").append("<br>=> C'est un problème de sécurité CORS ou de connexion internet.");
                } else if (jqXHR.status == 403 || jqXHR.status == 401) {
                    $("#erreur").append("<br>=> L'API refuse l'accès (Clé API peut-être invalide ?).");
                } else if (jqXHR.status == 404) {
                    $("#erreur").append("<br>=> L'adresse de l'API n'existe pas.");
                }
            });
        });
    </script>
</body>
</html>
