<!DOCTYPE html>
<html prefix="og: http://ogp.me/ns#" lang="fr">
<head>
    <meta charset="UTF-8">
    <title>ACCES IMMOBILIER - Liste des biens en vente</title>
    <meta name="site-verification" content="check"/>
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="_token" content="4e64Crze5sF1QCwu67VIthpgofFIEy1D6Or2ewd5">
    <link rel="alternate" type="application/rss+xml" href="feed_rss.xml" />
    <link rel="stylesheet" href="../modele/css/bootstrap.minb1fb.css?1574429566">
    <link rel="canonical" href="listing-vente.html"/>    
    
    <link href="../../use.fontawesome.com/releases/v5.0.10/css/all.css" rel="stylesheet" type="text/css" id="fontawesome-css" />
    <link href="../css/leaflet-bundle.min9b67.css?1574428957" rel="stylesheet" type="text/css" id="leaflet-css" />
    <link href="../css/bootstrap-select.min9b67.css?1574428957" rel="stylesheet" type="text/css" id="bootstrap-select-css" />
    <link rel="stylesheet" href="../css/premium/mainb001.css?1638779072">
    <link rel="stylesheet" href="../../cdnjs.cloudflare.com/ajax/libs/font-awesome/6.2.1/css/all.min.css">
    <link rel="stylesheet" href="../modele/css/main2f8b.css?1731080346">
    <link href="../../unpkg.com/aos%402.3.1/dist/aos.css" rel="stylesheet">
    <link rel="stylesheet" href="../modele/css/ajaxb1fb.css?1574429566">
    <link rel="stylesheet" href="../assets/css/appcffb.css?1718179493">
    <link rel="shortcut icon" href="../assets/images/favicon/faviconbfd8.ico?1717568386" type="image/x-icon">
    
    <link rel="preconnect" href="https://fonts.googleapis.com/">
    <link rel="preconnect" href="https://fonts.gstatic.com/" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Montserrat:ital,wght@0,100;0,200;0,300;0,400;0,500;0,600;0,700;0,800;0,900;1,100;1,200;1,300;1,400;1,500;1,600;1,700;1,800;1,900&amp;display=swap" rel="stylesheet">
    <link rel="stylesheet" href="../../use.fontawesome.com/releases/v5.0.10/css/all.css" integrity="sha384-+d0P83n9kaQMCwj8F4RJB66tzIwOKmrdb46+porD/OvrJ+37WqIM7UoBtwHO6Nlg" crossorigin="anonymous">
</head>

<body class="listing-vente">

    <div class="modal fade" id="myModal" role="dialog">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <div></div>
                    <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                        <span aria-hidden="true">&times;</span>
                    </button>
                </div>
                <div id="form-recherche-modal-content" class="modal-body"></div>
            </div>
        </div>
    </div>

    <aside id="menu" class="aside_contact" style="transform: translateX(0px);">
        <div class="contact_contain">
            <div class="slider-exit text-right hidden-sm-down">
                <i class="ion-android-close"></i>
            </div>
            <div class="pres_agency mt-5 mb-5">
                <figure class="contact_img hidden-sm-down">
                    <img src="../assets/images/logo_index6764.png?1717568206" alt="ACCES IMMOBILIER">
                </figure>
            </div>
            <div class="contact_coordinates ">
                <address>
                    <ul>
                        <li>27 avenue Pasteur</li>
                        <li>11800 Trèbes</li>
                        <li>
                            <div type="button" id="voir-telephone-0" class="w-100 btn intention_appel" data-tel="04 68 78 53 20" data-agence="0">
                                <i class="ion-ios-telephone-outline"></i>
                                <span class="intention_appel_txt">Voir le téléphone</span>
                            </div>
                        </li>
                    </ul>   
                    <div class="group_btn">
                        <a href="contact.html" class="btn btn-primary" title=""><i class="ion-ios-email-outline"></i> <span>Nous contacter</span></a>
                        <a href="on-vous-rappelle.html" class="btn btn-info" title="" rel="nofollow"><i class="ion-ios-telephone-outline"></i> <span>On vous rappelle</span></a>
                    </div>
                </address>
            </div>
            <div class="aside_map hidden-sm-down">
                <div class="contact_titre">Nous situer</div>
                <div id="map">
                    <img src="../assets/images/map/aside_map535f.png?1632398862" alt="map">            
                </div>
            </div>
            <div class="social_network">
                <ul class="list-inline">
                    <li class="list-inline-item"><a href="https://www.facebook.com/remaxaccesimmobilier/" rel="nofollow" title="Suivez-nous sur Facebook" target="_blank"><i class="ion-social-facebook"></i></a></li>
                    <li class="list-inline-item"><a href="https://www.instagram.com/remax_acces_immobilier/" title="Suivez-nous sur Instagram" rel="nofollow" target="_blank"><i class="ion-social-instagram"></i></a></li>
                </ul>
            </div>
        </div>
    </aside>

    <div class="header text-sm-center">
        <div class="sticky_menu hidden-sm-down">
            <div class="site-container">
                <div class="site-pusher">
                    <a href="../fr.html" class="header__icon" id="header__icon"><div class="burger-item"></div></a>
                    <a href="../fr.html" title="ACCES IMMOBILIER" class="header__logo">
                        <img src="../assets/images/logo4561.jpg?1717568236" class=" img-fluid" alt="ACCES IMMOBILIER" />
                    </a>
                    <div class="container">
                        <nav class="menu">
                            <ul>
                                <li><a href="../fr.html">Accueil</a></li>
                                <li class="active"><a href="listing-vente.html">Vente</a></li>
                                <li><a href="listing-location.html">Location</a></li>
                                <li><a href="estimation.html">Estimation</a></li>
                                <li><a href="alerte-email.html">Alerte email</a></li>
                                <li><a href="agence.html">Agence</a></li>
                                <li><a href="contact.html">Contact</a></li>
                            </ul>
                        </nav>            
                    </div>
                    <div class="site-cache" id="site-cache"></div>
                </div> 
            </div> 
            <div class="bloc bloc4">
                <li class="list-inline-item">
                    <a type="button" class="" data-toggle="modal" data-target="#myModal"><i class="ion-ios-search-strong"></i></a>
                </li>
            </div>
            <div class="lang nav-desktop-lang" style="position:absolute; z-index:20; top:3px; right:3px;">
                <a href="../fr.html" title="ACCES IMMOBILIER" rel="nofollow" style="display:inline-block;"><img src="../assets/images/flag-fr.jpg" alt="" /></a>
                <a href="../en.html" title="ACCES IMMOBILIER" rel="nofollow" style="display:inline-block;"><img src="../assets/images/flag-en-active.jpg" alt="ACCES IMMOBILIER" /></a>
            </div>

            <div class="container_search">
                <form action='listing.html' method='get' name='form_rech' id="formrecherchevente" class="formSearch">
                    <div class="container pb20">
                        <div class="search_form d-flex flex-wrap">      
                            <div class="form-group search__form-item c_type">
                                <div class="champs">
                                    <select class="selectpicker" multiple name="type[]" id="type" data-style='btn-cms' data-size='5' data-actions-box='true' data-deselect-all-text="Supprimer tout" data-select-all-text="Ajouter tout" data-none-selected-text='Type de bien'>
                                        <option value="maison">Maison</option>
                                        <option value="appartement">Appartement</option>
                                        <option value="terrain">Terrain</option>
                                        <option value="local">Local commercial</option>
                                        <option value="professionnel">Local professionnel</option>
                                    </select>
                                </div>
                            </div>
                            <div class="form-group search__form-item c_insee">
                                <div class="champs">
                                    <select class="selectpicker" multiple name="insee[]" id="insee" data-style='btn-cms' data-size='5' data-actions-box='true' data-deselect-all-text="Supprimer tout" data-select-all-text="Ajouter tout" data-none-selected-text='Ville'>
                                        <option value="11069">Carcassonne</option>
                                        <option value="11397">Trebes</option>
                                        </select>
                                </div>
                            </div>
                            <div class="form-group search__form-item c_prixmax">
                                <div class="champs">
                                    <input class="form-style" type="int" name="prixmax" id="prixmax" value="" placeholder="Budget max" />
                                    <span class="input-group-addon bs-caret">&euro;</span>
                                </div>
                            </div>
                            <div class="search__form-item c_valid" title="Recherche par critères">
                                <input class="btn btn-primary w-100" type="submit" name="btnSubmit" value="Rechercher">
                            </div>
                        </div>
                    </div>
                </form>
            </div>
        </div>
    </div>

    <div id="content" class="main-content">
        <div class="container">
            <div id="formrecherchevente-bar" class="fiche_produit">
                <div class="action_bar mb-3 mt-3">
                    <div class="breadcrumb-cms" itemscope itemtype="http://schema.org/BreadcrumbList">
                        <div class="breadcrumb-item" itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
                            <a itemprop="item" href="../fr.html" title="Accueil"><span itemprop="name">Accueil</span><meta itemprop="position" content="1" /></a>
                        </div>
                        <div class="breadcrumb-item active">Liste des biens en vente</div>
                    </div>
                    <div class="d-flex">
                        <div class="block_tri_list d-flex mr-2">
                            <label>Trier par ...</label>
                            <select id="select_tri" name="select_tri" class="selectpicker" data-style='btn-cms'>
                                <option value="date1-desc" selected="selected">Date décroissante</option>
                                <option value="prix-asc">Prix croissant</option>
                                <option value="prix-desc">Prix décroissant</option>
                            </select>
                        </div>
                    </div>
                </div>  
            </div>
        </div>

        <div class="display-4"></div>

        <div class="container prod_listing" id="listing-vente">
            
            <div id="loading-message" class="text-center" style="width:100%; padding:50px;">
                <i class="fa fa-spinner fa-spin fa-3x"></i><br>Chargement des biens en cours...
            </div>

            <div id="template-annonce" style="display:none;">
                <div class="listing_article clearfix">
                    <div class="article_content">
                        <article class="item-listing">
                            <a href="#" class="item-link lien-detail"></a>
                            
                            <div class="block_img">
                                <div class="bandeaux">
                                    <div class="block_etiquette b_exclu etiquette-exclu" style="display:none;">Exclusivité</div>
                                </div>
                                <div class="carousel slide">
                                    <div class="carousel-inner">
                                        <div class="carousel-item active">
                                            <img class="d-block img-fluid photo-principale" src="" alt="Photo">
                                        </div>
                                    </div>
                                </div>
                            </div>

                            <div class="block_info">
                                <div class="effect-cms">
                                    <div class="card-fav-absolute"><i class="tea ion-ios-heart adfav"></i></div>

                                    <div class="header-item">
                                        <div class="spin1 info_type">Maison</div>
                                        <span class="spin2 info_titre">Titre du bien</span>
                                        <div class="spin3 info_ville">
                                            <i class="tea ion-ios-location-outline"></i> <span>VILLE</span>
                                        </div>
                                    </div>

                                    <div class="box">
                                        <div class="line"><div class="triangle"></div></div>
                                    </div>

                                    <div class="spin4 info_prix">0 €
                                        <div class="info_prix-hai">* Honoraires charge vendeur</div>
                                    </div>

                                    <ul class="card_list hidden-sm-down">
                                        <li><span class="val info_pieces">-</span> Pièces</li>
                                        <li><span class="val info_chambres">-</span> Chambres</li>
                                        <li><span class="val info_surface">-</span> m²</li>
                                    </ul>

                                    <div class="infos-flex">
                                        <div class="col1">
                                            <div class="description info_desc">Description...</div>
                                        </div>
                                        <div class="col2">
                                            <ul><li><div>Surface</div><div class="info_surface_detail">- m²</div></li></ul>
                                            <ul><li><div>Terrain</div><div class="info_terrain">- m²</div></li></ul>
                                        </div>
                                    </div>

                                    <div class="card_foot hidden-sm-down">
                                        <div class="d-flex justify-content-between">
                                            <div class="spin5 info_ref align-text-bottom">Réf. -</div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </article>
                    </div>
                </div>
            </div>
            <div id="resultats-dynamiques"></div>      
            
            <div class="listing_pagination container mt-2"></div>
        </div>
        </div>
    <div>
      <div class="ajax-overlay"></div>
      <div id="ajax-loader"></div>
    </div>

    <div class="cont_coordonnees">
        <div class="container">
            <div class="coordonnees_heading col-md-12">
                <figure>
                    <a href="../fr.html"><img src="../assets/images/logo_index.jpg" alt="ACCES IMMOBILIER" class="img-fluid"></a>
                </figure>
            </div>
            <div class="row">
                <div class="address col-xs-12 col-md-4">
                    <p> 27 avenue Pasteur 11800 Trèbes </p>
                    <a href="tel:04 68 78 53 20">
                        <div type="button" class="btn intention_appel">
                            <i class="ion-ios-telephone-outline"></i><span class="intention_appel_txt">Voir le téléphone</span>
                        </div>
                    </a>
                    <p><a style="color:#ffffff" href="mailto:contact@acces-immobilier.com">contact@acces-immobilier.com</a></p>
                </div>
                <div class="tel col-xs-12 col-md-4">
                    <div class="social">
                        <p>Nous suivre sur les réseaux sociaux :</p>
                        <ul class="list-inline">
                            <li class="list-inline-item"><a href="#" target="_blank"><i class="ion-social-facebook"></i></a></li>
                            <li class="list-inline-item"><a href="#" target="_blank"><i class="ion-social-instagram"></i></a></li>
                        </ul>
                    </div>
                </div>
                <div class="tel col-xs-12 col-md-4">
                    <a href="contact.html" class="mt-4 btn btn-primary hidden-sm-down" >Nous contacter</a>
                </div>
            </div>
        </div>
    </div>
    
    <footer>
        <div class="container">
            <div class="row align-items-center">
                <div class="col-xs-12 col-sm-6 liens_left my-auto">
                    <a href="mentions-legales.html" class="btn btn-footer">Mentions légales et honoraires</a>
                </div>
                <div class="col-xs-12 col-sm-6 liens_right">
                    <a href="#" target="_blank" rel="nofollow"><img src="../modele/images/credits/credit_blanc/credit_csib1fb.png?1574429566" alt="Création site immobilier"/></a>
                </div>
            </div>
        </div>
    </footer>

    <div id="bloc_fixed" class="d-flex flex-column">
        <div class="bloc bloc1" id="toggle-menu" title="Nous contacter"><ul class="list-inline"><li class="list-inline-item"><i class="ion-ios-email-outline"></i></li></ul></div>
        <div class="bloc bloc2"><a id='alerte-email-link' href="alerte-email.html"><ul class="list-inline"><li class="list-inline-item"><i class="ion-ios-bell-outline"></i></li></ul></a></div>
        <div class="bloc bloc3"><a href="comparateur.html"><ul class="list-inline"><li class="list-inline-item"><i class="ion-ios-heart-outline"></i><span class="badge badge-pill badge-danger surcharge_favoris">0</span></li></ul></a></div>
    </div>

    <script src="../modele/js/cookieconsent.minb1fb.js?1574429566" type="text/javascript"></script>
    <script src="../modele/js/jquery-3.2.1.minb1fb.js?1574429566" type="text/javascript"></script>
    <script src="../../code.jquery.com/ui/1.12.0-rc.2/jquery-ui.js"></script>
    <script src="../modele/js/popper.minc75d.js?1646733235" type="text/javascript"></script>
    <script src="../modele/js/bootstrap.minb1fb.js?1574429566" type="text/javascript"></script>
    <script src="../../unpkg.com/aos%402.3.1/dist/aos.js"></script>
    <script>AOS.init();</script>
    <script src="../../kit.fontawesome.com/2ed742e839.html" crossorigin="anonymous"></script>

    <script>
    $(document).ready(function() {
        console.log("Démarrage script API...");
        
        // 1. Ton API Skysignage
        const apiDirecte = "https://apim.skysignage.com/WCF/connector/d12a2a90-f1f7-59b0-a8ca-247e2907debf/78ecd32d-d37c-5628-8ab1-70a2792afb18?subscription-key=3a826b2799bd491aae7814f41351a46a";
        
        // 2. Le Proxy pour contourner la sécurité CORS (Essentiel)
        const urlProxy = "https://api.allorigins.win/raw?url=" + encodeURIComponent(apiDirecte);

        $.getJSON(urlProxy, function(response) {
            console.log("Données reçues");
            let listings = response.data || response; // Gère les différents formats

            if (listings) {
                $('#loading-message').hide(); // Cacher le chargement

                $.each(listings, function(index, item) {
                    
                    // Fonction utilitaire pour lire les données compliquées
                    function getVal(key) {
                        if (Array.isArray(item)) {
                            let found = item.find(x => x.std_name === key);
                            return found ? found.value : "";
                        }
                        return item[key] || "";
                    }

                    // --- FILTRE : VENTE UNIQUEMENT ---
                    if (getVal("category") !== "0") return;

                    // --- REMPLISSAGE DU MOULE ---
                    let template = $('#template-annonce').children().clone();

                    let id = getVal("id");
                    let photos = getVal("pictures");
                    let photoUrl = '../assets/images/sans-photo.jpg';

                    // Gestion image
                    if (Array.isArray(photos) && photos.length > 0) photoUrl = photos[0];
                    else if (typeof photos === 'string' && photos.length > 5) photoUrl = photos;

                    // Liens et Images
                    template.find('.lien-detail').attr('href', 'detail.html?id=' + id);
                    template.find('.photo-principale').attr('src', photoUrl);

                    // Textes
                    template.find('.info_type').text(getVal("type_name") || "Maison");
                    template.find('.info_titre').text(getVal("title") || "Bien à vendre");
                    template.find('.info_ville span').text(getVal("city"));

                    // Prix
                    let prix = getVal("price_format");
                    if (prix && !prix.includes('€')) prix += ' €';
                    template.find('.info_prix').html(prix + ' <sup class="prixplus">*</sup><div class="info_prix-hai">* Honoraires charge vendeur</div>');

                    // Détails
                    template.find('.info_pieces').text(getVal("rooms") || getVal("bedrooms") || "-");
                    template.find('.info_chambres').text(getVal("bedrooms") || "-");
                    template.find('.info_surface').text(getVal("area_size") || "-");
                    template.find('.info_surface_detail').text((getVal("area_size") || "-") + " m²");
                    
                    let terrain = getVal("land_area");
                    template.find('.info_terrain').text(terrain ? terrain + " m²" : "-");

                    let desc = getVal("description");
                    if (desc) template.find('.info_desc').text(desc.substring(0, 140) + "...");
                    
                    template.find('.info_ref').text("Réf. " + getVal("reference"));

                    // Ajout au site
                    $('#resultats-dynamiques').append(template);
                });

                if ($('#resultats-dynamiques').children().length == 0) {
                    $('#loading-message').show().html("Aucun bien à la vente trouvé pour le moment.");
                }
            }
        }).fail(function() {
            $('#loading-message').html("<span style='color:red'>Erreur de connexion serveur.</span>");
        });
    });
    </script>
</body>
</html>
